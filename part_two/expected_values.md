## 期待値に基づく意思決定
### 4.1 意思決定問題の構成要素

```
本章では, 不確実性を確率で表現して, 確率を使った意思決定を行う手続きを解説する
自然の状態の確率分布P(θ)がわかっている場合の意思決定問題をリスク下の意思決定問題と呼ぶ
意思決定の要素を整理すると下記のようになる
ただし, Aは選択肢の集合, Θは自然の状態の集合, cは選択肢と自然の状態が定まった場合の利得である
```

<img width="486" alt="スクリーンショット 2021-07-17 20 35 58" src="https://user-images.githubusercontent.com/43327056/126035604-e1e20e0e-8a9c-4891-8d14-c1e309204408.png">

```
本章において, A, Θは有限集合であり, その要素の個数を各々#A, #Θとする
また利得は金額で表されるものとする
```

### 4.2 期待値

```
本章では利得の期待値に基づく意思決定を解説する
確実的にランダムに変化する値を確率変数や乱数と呼ぶ. また, 具体的な値を実現値と呼ぶ
本書では, 確率変数と実現値を指揮の上では区別しない

離散型の確率変数xの期待値E(x)は以下のように計算できる（ただし, i=1, 2, ..., m）
またP(x=x_i)はx=x_iとなる確率である. 今後は, 単にP(x_i)と書くこともある
```

<img width="486" alt="スクリーンショット 2021-07-17 20 48 10" src="https://user-images.githubusercontent.com/43327056/126035909-c594250f-fe53-4b6b-aba0-70721645b469.png">

```
なお, 確率変数と確率との対応を確率分布と呼ぶ. 本書では, 確率と確率分布を共にPと表記する
確率変数xが確率分布P(x)に従うことをx~P(x)と記す
```

### 4.3 期待金額に基づく意思決定

```
期待金額を最大にするという原理に基づく意思決定を行う
```

#### 4.3.1　数式による表現

```
自然の状態の確率分布P(θ)が与えられている下で, 何らかの選択a_jを行なったときの期待金額EMV(a_j|P(θ))は次のように計算できる
```

<img width="486" alt="スクリーンショット 2021-07-17 20 56 40" src="https://user-images.githubusercontent.com/43327056/126036078-48ee6b5f-da1a-4936-973d-edfb431888f7.png">

```
EMV(a_j|P(θ))を最大にする選択肢をa*と表記することにする
```

<img width="486" alt="スクリーンショット 2021-07-17 21 00 23" src="https://user-images.githubusercontent.com/43327056/126036185-8ba11e75-d1f6-485d-a5a6-f3dc14e3f705.png">

```
記号a*を使うと, 利得行列と自然の状態の確率分布が与えられた下での最大の期待金額はEMV(a*|P(θ))となる
```

<img width="486" alt="スクリーンショット 2021-07-17 21 04 20" src="https://user-images.githubusercontent.com/43327056/126036278-73ef2057-170f-4e80-a415-b385507d11d1.png">

#### 4.3.2　数値例

```
利得行列を再掲する
```

<img width="536" alt="スクリーンショット 2021-07-17 10 00 17" src="https://user-images.githubusercontent.com/43327056/126020723-9cb79a64-16a4-428b-8efc-ca1676441468.png">

```
仮に, 好況になる確率が0.4で, 不況になる確率が0.6だったとする
すなわちP(θ_1) = 0.4でありP(θ_2) = 0.6である

選択肢ごとに期待金額を計算する
「0台稼働a_1」を選んだときの期待金額は以下のように計算される
```

<img width="486" alt="スクリーンショット 2021-07-18 10 23 11" src="https://user-images.githubusercontent.com/43327056/126052844-18d5203b-9d71-4b74-927f-36a0bf60e469.png">

```
「1台稼働a_2」を選んだときの期待金額は以下のように計算される
```

<img width="486" alt="スクリーンショット 2021-07-18 11 09 33" src="https://user-images.githubusercontent.com/43327056/126053511-8b520f30-5ef3-4f3b-b193-ba0e7f123445.png">

```
「2台稼働a_3」を選んだときの期待金額は以下のように計算される
```

<img width="486" alt="スクリーンショット 2021-07-18 11 09 48" src="https://user-images.githubusercontent.com/43327056/126053512-3e010f41-e6f1-4acf-bbc4-f0c4b79f27d8.png">

#### 4.3.3　Python実装

```python
# 期待金額最大化に基づく意思決定を行う関数
def max_emv(probs, payoff_table):
    emv = payoff_table.mul(probs, axis=0).sum()
    max_emv = emv.max()
    a_star = argmax_list(emv)
    return pd.Series([a_star, max_emv], index=["選択肢", "期待金額"])

payoff = pd.DataFrame({
    "0台": [-100, -100],
    "1台": [300, 300],
    "2台": [700, -300]
})
payoff.index = ["好況", "不況"]

prob_state = pd.Series([0.4, 0.6])
prob_state.index = ["好況", "不況"]

max_emv(prob_state, payoff)
```

### 4.4 期待金額に基づく意思決定の問題点

```
期待金額に基づく意思決定を行う人を期待金額者という
この意思決定方法がベストであるとは限らない

例えば, 以下の2つの選択肢では, どちらの方が好ましいと感じるか

- 50%の確率で10万円をもらえるが, 50%の確率で全くお金がもらえない → 期待金額は5万円
- 確実に（確率1で）5万円もらう → 期待金額は5万円

このような問題に関しては, 第4部で再度取り上げる
```

### 4.5 決定木

```
決定木は, 意思決定の過程を可視化するために使用される
機械の稼働台数を決める問題における決定木は次のようになる
左側の決定木が一般的なもので, 右側の決定木には今回の決定問題に合わせて数値を書き入れている
```

<img width="486" alt="スクリーンショット 2021-07-18 12 43 20" src="https://user-images.githubusercontent.com/43327056/126054961-7feb1f73-578c-4688-aa5b-0530675469b9.png">

```
決定木は節（node）と枝（branch）からなる. 節は, 植物における茎や葉が出てくるところを指す
四角印は決定ノードと呼ばれ, 選択肢が分岐する箇所である
丸印はチャンスノードと呼ばれ, 自然の状態が分岐する箇所である
節（ノード）から伸びる枝の終点が, 最終的に得られる利得である
利得行列を図式化したものだといえる
```

<img width="486" alt="スクリーンショット 2021-07-18 12 49 37" src="https://user-images.githubusercontent.com/43327056/126055066-da1aaf2c-6e5e-4cc4-9495-426b103a8bf7.png">

```
この図は, チャンスノードに付与される確率と, チャンスノードごとに利得の期待値を書き入れたものである
```

### 4.6 展開型分析

```
意思決定分析の手順の1つが展開型分析である. 展開型分析は以下の4つの段階からなる
  Step1: 決定木の形（節と枝）を作る
  Step2: 枝の末尾に利得（金額以外でも可）を書き入れる
  Step3: チャンスノードに確率を書き入れる
  Step4: 利得の期待値に基づいて意思決定を行う
  
計算の処理的には以下のようになる
  Step1: 選択肢ごと自然の状態ごとに利得を整理する
  Step2: 自然の状態に対して確率を割り振る
  Step3: 利得の期待値に基づいて意思決定を行う
```
